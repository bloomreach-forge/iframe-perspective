<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-04-18
 | Rendered using Hippo Forge Maven Skin 1.04.00 based on Apache Maven Fluido Skin
-->
<!--[if lt IE 7]><html id="ie6" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 7]><html id="ie7" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 8]><html id="ie8" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if IE 9]><html id="ie9" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if !IE]>--><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><!--<![endif]-->

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                    <meta name="Date-Revision-yyyymmdd" content="20170418"/>
                <meta http-equiv="Content-Language" content="en"/>
        <title>Hippo IFrame Perspective Plugin &#x2013; How to build secure non-Wicket-component based pages?</title>
    <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-1.04.00.min.css"/>
    <link rel="stylesheet" href="./css/forge-maven-skin-1.04.00.min.css"/>
    <link rel="stylesheet" href="./css/site.css"/>
    <link rel="stylesheet" href="./css/print.css" media="print"/>

        
    <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-1.04.00.min.js"></script>
    <script type="text/javascript" src="./js/forge-maven-skin-1.04.00.min.js"></script>

    
            </head>
    <body>

        
    
    
    <div class="container-fluid">
        <div class="row-fluid">
            <div id="header">
                <div id="logo">
                    <a href="http://www.onehippo.com">
                        <img src="./images/hipposkin/hippo-logo.png" alt="Hippo Logo" />
                    </a>
                </div>

                <h1>
                                            Hippo IFrame Perspective Plugin
                    
                </h1>
                <div class="clearfix"></div>
            </div>
        </div>

        <div class="row-fluid">
            <div id="breadcrumbs" class="clearfix">
                <ul class="breadcrumb">
                                
                                        
                            <li id="publishDate">Last Published: 2017-04-18</li>
                                                                                                                                                </ul>

                <div class="links">
                    <a href="https://www.onehippo.com">Onehippo.com</a>
                    <a href="https://www.onehippo.org">Onehippo.org</a>
                </div>
            </div>
        </div>



            
    <div class="row-fluid">
        <div id="leftColumn" class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                                        <li class="nav-header">Home</li>
                                                           
        <li>
    
                                                <a href="index.html" title="Home">
                    <i class="none"></i>
                Home</a>
                    </li>
                               
        <li>
    
                                                <a href="release-notes.html" title="Release Notes">
                    <i class="none"></i>
                Release Notes</a>
                    </li>
                                                            <li class="nav-header">Usage</li>
                                                           
        <li>
    
                                                <a href="install.html" title="Installation">
                    <i class="none"></i>
                Installation</a>
                    </li>
                               
        <li class="active">
    
                        <a href="#"><i class="none"></i>How to build secure non-Wicket-component based pages</a>
                </li>
                                                            <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        <li>
    
                                                <a href="project-info.html" title="Project Information">
                    <i class="icon-chevron-right"></i>
                Project Information</a>
                                </li>
                                                                                                                                                                                                                                                               
        <li>
    
                                                <a href="project-reports.html" title="Project Reports">
                    <i class="icon-chevron-right"></i>
                Project Reports</a>
                                </li>
                        </ul>

                
                <hr class="divider"/>

                <div id="poweredBy">
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                                <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png"/>
        </a>
                            </div>
            </div>
        </div>
    
        
        <div id="bodyColumn"  class="span9" >
                                
            <!-- Copyright 2010 Hippo Licensed under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License. You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0 Unless required by
    applicable law or agreed to in writing, software distributed under
    the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
    OR CONDITIONS OF ANY KIND, either express or implied. See the
    License for the specific language governing permissions and
    limitations under the License. -->
  
    <div class="section">
<h2><a name="How_to_build_secure_non-Wicket-component_based_pages"></a>How to build secure non-Wicket-component based pages?</h2>
      
<p>
        When using the IFrame Perspective Plugin, it's probably easy to use some Servlet or JSP or
        any other Servlet compliant technologies to create pages embedded inside the IFrame perspective.
      </p>
      
<p>
        However, in this case, some concerns arise. For example,
      </p>
      
<ul>
        
<li>How can we secure the pages inside the IFrame perspective, allowing access only to authenticated users in CMS?</li>
        
<li>In the page inside the IFrame perspective, how can we use the same JCR session as the current authenticated CMS user is using?</li>
        
<li>...</li>
      </ul>
      
<p>
        The solution is quite easy actually. Basically Apache Wicket provides <tt>org.apache.wicket.protocol.http.servlet.WicketSessionFilter</tt> which lets you access <tt>WicketSession</tt> in your non-Wicket-component based Servlet/JSP or any other Servlet compliant applications.
      </p>
      
<p>
        As a simple example, let's suppose you want to embed <tt>/cms/examples/whoweare.jsp</tt> page
        in the IFrame perspective and you want to use the JCR session for the currently authenticated CMS user. In this case,
        you should add the following in <tt>cms/WEB-INF/web.xml</tt>.
      </p>
      
<div class="brush: xml">
        
<div class="source"><pre class="prettyprint linenums">

  &lt;!-- SNIP --&gt;

  &lt;!-- The WicketSesionFilter can be used to provide thread local access to Servlet/JSP, etc. --&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;WicketSessionFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.apache.wicket.protocol.http.servlet.WicketSessionFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;filterName&lt;/param-name&gt;
      &lt;!-- expose the session of the CMS app --&gt;
      &lt;param-value&gt;CMS&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;

  &lt;!-- SNIP --&gt;

  &lt;!-- couple the session filter to any Servlet-compliant pages mapped by /examples/*. --&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;WicketSessionFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/examples/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;

  &lt;!-- SNIP --&gt;

        </pre></div>
      </div>
      
<p>
        <i>Note</i>: Please note that <tt>WicketSessionFilter</tt> filter-mapping should be placed
        after any other built-in CMS Wicket filters.
      </p>
      
<p>
        Then any pages mapped by <tt>/examples/*</tt> can get the Wicket Session to secure the page like the following example:
      </p>
      
<div class="brush: java">
        
<div class="source"><pre class="prettyprint linenums">
    org.apache.wicket.Session wicketSession = null;

    try {
        wicketSession = org.apache.wicket.Session.get();
    } catch (Exception ignore) {
    }

    if (wicketSession == null) {
        // wicket session is unavailable, meaning the request is not from CMS-authenticated user!
        response.sendError(403);
        return;
    }
        </pre></div>
      </div>
      
<p>
        You can also get CMS JCR session like the following example, too:
      </p>
      
<div class="brush: java">
        
<div class="source"><pre class="prettyprint linenums">
    org.hippoecm.frontend.session.UserSession userSession = org.hippoecm.frontend.session.UserSession.get();
    javax.jcr.Session jcrSession = userSession.getJcrSession();
        </pre></div>
      </div>
      
<p>
        Please check out <a href="index.html#Demo_Application">Demo Application</a> for a working example.
      </p>
    </div>
  

            </div>
        </div>
    </div>

    <hr/>

    <footer>
                <div class="container-fluid">
                <div class="row span12">Copyright &copy;                                                2017.
                        All Rights Reserved.            
                                        
            </div>

        
        
                </div>
    </footer>
</body>
</html>
