<?xml version="1.0"?><!--
    Copyright 2011-2018 Hippo Licensed under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License. You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0 Unless required by
    applicable law or agreed to in writing, software distributed under
    the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
    OR CONDITIONS OF ANY KIND, either express or implied. See the
    License for the specific language governing permissions and
    limitations under the License.
  --><!DOCTYPE document PUBLIC "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
<document>
  <properties>
    <title>How to install the IFrame Perspective Plugin</title>
  </properties>
  <body>
    <section name="How to install the IFrame Perspective Plugin">
      <subsection name="Prerequisites">
        <p>
          These instruction assumes that you have maven 3 based build for your site.
        </p>
      </subsection>

      <subsection name="Add the Forge repository configuration">
        <p>In the main <code>pom.xml</code> of the project, in the <code>repositories</code> section, add this repository if it is not configured there yet.</p>
        <div class="brush: xml">
          <source><![CDATA[
    <repository>
      <id>hippo-forge</id>
      <name>Bloomreach Forge maven 2 repository.</name>
      <url>https://maven.onehippo.com/maven2-forge/</url>
      <snapshots>
        <enabled>false</enabled>
      </snapshots>
      <releases>
        <updatePolicy>never</updatePolicy>
      </releases>
      <layout>default</layout>
    </repository>
        ]]></source>
        </div>
      </subsection>

      <subsection name="Add version property to the project pom">
        <p>In the main <code>pom.xml</code> of the project, in the properties section, add this property. For the correct version number, check the <a href="release-notes.html">Release Notes</a> page.</p>
        <div class="brush: xml">
          <source><![CDATA[
    <forge.iframeprspectiv.version>version.number</forge.iframeprspectiv.version>
        ]]></source>
        </div>
      </subsection>

      <subsection name="Maven Dependency">
        <p>Make sure you have the dependency definition in the root pom.xml of your project:</p>
        <div class="brush: xml">
        <source><![CDATA[
<!-- SNIP -->

<dependencyManagement>

  <!-- SNIP -->

  <dependencies>

    <!-- SNIP -->

    <!-- NOTE: You should set a property named 'forge.iframeprspectiv.version' to a version of this plugin! -->

    <dependency>
      <groupId>org.onehippo.forge.iframeprspectiv</groupId>
      <artifactId>iframeprspectiv</artifactId>
      <version>${forge.iframeprspectiv.version}</version>
    </dependency>

    <!-- SNIP -->

  </dependencies>

  <!-- SNIP -->

</dependencyManagement>
        ]]></source>
        </div>
        <p>
          Add the following dependency to either <code>cms-dependencies/pom.xml</code> in Hippo CMS v13
          or <code>cms/pom.xml</code> in the earlier versions:
        </p>
        <div class="brush: xml">
        <source><![CDATA[
  <!-- SNIP -->

  <dependencies>

    <!-- SNIP -->

    <dependency>
      <groupId>org.onehippo.forge.iframeprspectiv</groupId>
      <artifactId>iframeprspectiv</artifactId>
    </dependency>

    <!-- SNIP -->

  </dependencies>
        ]]></source>
        </div>
      </subsection>

      <subsection name="Add the plugin configuration to the repository">

        <p>
          If you want to add IFrame based perspective configurations, you need to add configuration nodes (e.g, <code>example-iframe-perspective</code>)
          into the <code>/hippo:configuration/hippo:frontend/cms/cms-static/</code> node in the repository.
          In the following example, for demonstration purpose, two IFrame based perspectives were added:
          One is 'example-iframe-perspective' and the other is 'example-iframe-perspective-second'.
        </p>

        <div class="brush: plain">
        <source><![CDATA[
definitions:
  config:
    /hippo:configuration/hippo:frontend/cms/cms-static:
      /example-iframe-perspective:
        jcr:primaryType: frontend:plugin
        jcr:mixinTypes: ['frontend:navigationitem']
        frontend:appPath: example-iframe-perspective
        hipposys:userrole: xm.cms.user
        plugin.class: org.onehippo.forge.iframeprspectiv.GenericIFramePerspective
        wicket.id: service.tab
        iframe.src: https://bloomreach-forge.github.io/
        x-frame-options: ALLOW-FROM http://www.example.org
        /layout.wireframe:
          jcr:primaryType: frontend:pluginconfig
          center: id=generic-iframe-perspective-center,body=generic-iframe-perspective-center-body,scroll=true
          linked.with.parent: true
          root.id: generic-iframe-perspective-wrapper
          top: id=generic-iframe-perspective-top,body=generic-iframe-perspective-top-body,height=35
      /example-iframe-perspective-second:
        jcr:primaryType: frontend:plugin
        jcr:mixinTypes: ['frontend:navigationitem']
        frontend:appPath: example-iframe-perspective-second
        hipposys:userrole: xm.cms.user
        plugin.class: org.onehippo.forge.iframeprspectiv.GenericIFramePerspective2
        wicket.id: service.tab
        iframe.src: https://bloomreach-forge.github.io/iframe-perspective/
        x-frame-options: ALLOW-FROM http://www.example.org
        /layout.wireframe:
          jcr:primaryType: frontend:pluginconfig
          center: id=generic-iframe-perspective-center,body=generic-iframe-perspective-center-body,scroll=true
          linked.with.parent: true
          root.id: generic-iframe-perspective-wrapper
          top: id=generic-iframe-perspective-top,body=generic-iframe-perspective-top-body,height=35
        ]]></source>
        </div>

        <p>
          <em>Note:</em> Each perspective must have unique, mandatory <code>frontend:appPath</code> configurations like the above example.
          See the
          <a href="https://documentation.bloomreach.com/14/library/concepts/editor-interface/cms-perspectives.html">Create a Custom Perspective</a>
          page for further detail.
        </p>

        <p>
          Also, the translation key-value pairs for each perspective must be added to <code>/hippo:configuration/hippo:translations/hippo:navigation/navigationitem</code>
          like the following example:
        </p>

        <div class="brush: plain">
        <source><![CDATA[
definitions:
  config:
    /hippo:configuration/hippo:translations/hippo:navigation/navigationitem/displayName/en:
      example-iframe-perspective: Example IFrame Perspective
      example-iframe-perspective-second: Example IFrame Perspective 2nd
        ]]></source>
        </div>

        <p>
          <em>Note:</em> The translation keys must be the same as the <code>frontend:appPath</code> property values.
          See the
          <a href="https://documentation.bloomreach.com/14/library/concepts/editor-interface/cms-perspectives.html">Create a Custom Perspective</a>
          page for further detail.
        </p>

      </subsection>
      <subsection name="Plugin Configuration Details">
        <p>You can configure the followings:</p>
        <table>
          <tr>
            <th>Property</th>
            <th>Example value</th>
            <th>Default value</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>iframe.src</td>
            <td>http://www.onehippo.org</td>
            <td></td>
            <td>The initial source of the IFrame element</td>
          </tr>
          <tr>
            <td>x-frame-options</td>
            <td>ALLOW-FROM http://www.example.org</td>
            <td></td>
            <td>
              Optionally set <strong>X-Frame-Options</strong> response header if configured.
              <br/>
              See <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options</a> for details.
            </td>
          </tr>
          <tr>
            <td>content-security-policy</td>
            <td>Refer to the specification</td>
            <td></td>
            <td>
              Optionally set <strong>Content-Security-Policy</strong> response header if configured.
              <br/>
              See <a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy" target="_blank">https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy</a>
              and <a href="https://www.owasp.org/index.php/Content_Security_Policy">https://www.owasp.org/index.php/Content_Security_Policy</a>
              for details.
            </td>
          </tr>
          <tr>
            <td>x-content-security-policy</td>
            <td>Refer to the specification</td>
            <td></td>
            <td>
              Optionally set <strong>X-Content-Security-Policy</strong> response header if configured.
              <br/>
              See <a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy" target="_blank">https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy</a>
              and <a href="https://www.owasp.org/index.php/Content_Security_Policy">https://www.owasp.org/index.php/Content_Security_Policy</a>
              for details.
            </td>
          </tr>
          <tr>
            <td>x-webkit-csp</td>
            <td>Refer to the specification</td>
            <td></td>
            <td>
              Optionally set <strong>X-Webkit-CSP</strong> response header if configured.
              <br/>
              See <a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy" target="_blank">https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy</a>
              and <a href="https://www.owasp.org/index.php/Content_Security_Policy">https://www.owasp.org/index.php/Content_Security_Policy</a>
              for details.
            </td>
          </tr>
          <tr>
            <td>iframe.*</td>
            <td></td>
            <td></td>
            <td>
              If there is any property with name starting with 'iframe.', then the remaining part after 'iframe.' will be added
              as an additional attribute of the iframe element.
              For example, if you add 'iframe.name' with value, 'myiframe', then the iframe will have <code>name="myiframe"</code> HTML attribute.
            </td>
          </tr>
        </table>
      </subsection>

    </section>
  </body>
</document>
